<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­¦æ˜Ÿæ²³ | AIæ™ºèƒ½é¢˜åº“ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #7209b7;
            --success: #4cc9f0;
            --warning: #f72585;
            --dark: #1a1b41;
            --light: #f8f9fa;
            --card-bg: rgba(255, 255, 255, 0.95);
            --border: rgba(67, 97, 238, 0.1);
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7ff 0%, #e3e9ff 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* æ¸å˜èƒŒæ™¯è£…é¥° */
        .gradient-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: radial-gradient(circle at 10% 20%, rgba(67, 97, 238, 0.05) 0%, transparent 20%),
                        radial-gradient(circle at 90% 80%, rgba(248, 37, 133, 0.05) 0%, transparent 20%),
                        radial-gradient(circle at 50% 50%, rgba(76, 201, 240, 0.03) 0%, transparent 30%);
        }
        
        /* å¯¼èˆªæ  */
        .main-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05);
        }
        
        .nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
            height: 70px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-icon i {
            color: white;
            font-size: 18px;
        }
        
        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.4rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 5px;
        }
        
        .nav-item {
            margin: 0 5px;
        }
        
        .nav-link {
            text-decoration: none;
            color: #666;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 12px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--primary);
            background: rgba(67, 97, 238, 0.08);
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            max-width: 1400px;
            margin: 90px auto 40px;
            padding: 0 40px;
        }
        
        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            margin-bottom: 40px;
        }
        
        .page-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #222;
            margin-bottom: 15px;
            position: relative;
            display: inline-block;
        }
        
        .page-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 2px;
        }
        
        .page-subtitle {
            font-size: 1.1rem;
            color: #666;
            max-width: 700px;
            line-height: 1.6;
        }
        
        /* ä¸‰æ å¸ƒå±€ */
        .three-column-layout {
            display: grid;
            grid-template-columns: 1fr 1.2fr 1fr;
            gap: 30px;
        }
        
        /* å·¦ä¾§ç­›é€‰é¢æ¿ */
        .filter-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        
        .panel-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: #222;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            color: var(--primary);
        }
        
        .filter-group {
            margin-bottom: 25px;
        }
        
        .filter-label {
            display: block;
            font-weight: 500;
            color: #444;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }
        
        .filter-select {
            width: 100%;
            padding: 14px 18px;
            background: white;
            border: 2px solid #eaeaea;
            border-radius: 12px;
            color: #333;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        /* é‡ç½®æŒ‰é’®åŒºåŸŸ */
        .reset-section {
            margin-top: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            border: 1px solid rgba(248, 37, 133, 0.1);
        }
        
        .reset-title {
            font-size: 1rem;
            font-weight: 600;
            color: #222;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .reset-title i {
            color: #f72585;
        }
        
        .reset-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .reset-btn {
            padding: 12px 18px;
            background: white;
            border: 2px solid #eaeaea;
            border-radius: 12px;
            color: #666;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            text-align: left;
        }
        
        .reset-btn:hover {
            border-color: #f72585;
            color: #f72585;
            background: rgba(248, 37, 133, 0.05);
        }
        
        .reset-btn i {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .reset-btn:hover i {
            opacity: 1;
        }
        
        .reset-btn.warning {
            background: rgba(248, 37, 133, 0.1);
            border-color: rgba(248, 37, 133, 0.2);
            color: #f72585;
        }
        
        .reset-btn.warning:hover {
            background: rgba(248, 37, 133, 0.2);
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.08), rgba(114, 9, 183, 0.08));
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(67, 97, 238, 0.1);
        }
        
        .stat-value {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #666;
        }
        
        /* æ™ºèƒ½ä½“åŒºåŸŸ */
        .ai-agent-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .agent-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .agent-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .agent-avatar i {
            color: white;
            font-size: 1.5rem;
        }
        
        .agent-info h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 600;
            color: #222;
            margin-bottom: 5px;
        }
        
        .agent-status {
            font-size: 0.85rem;
            color: #28a745;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .agent-status i {
            font-size: 0.6rem;
        }
        
        /* èŠå¤©åŒºåŸŸ - ä¿®æ”¹éƒ¨åˆ† */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
            max-height: 400px; /* æ·»åŠ å›ºå®šé«˜åº¦ */
            min-height: 400px; /* ç¡®ä¿æœ€å°é«˜åº¦ */
            border: 1px solid var(--border); /* æ·»åŠ è¾¹æ¡† */
            border-radius: 12px; /* åœ†è§’ */
            padding: 15px; /* å†…è¾¹è· */
            background: rgba(255, 255, 255, 0.8); /* åŠé€æ˜èƒŒæ™¯ */
            
            /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: var(--primary) rgba(67, 97, 238, 0.1); /* Firefox */
        }
        
        /* Webkitæµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ (Chrome, Safari, Edge) */
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: rgba(67, 97, 238, 0.05);
            border-radius: 10px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 10px;
        }
        
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
        }
        
        .chat-messages {
            display: flex;
            flex-direction: column;
            gap: 15px; /* å‡å°é—´éš™ */
            min-height: 100%; /* ç¡®ä¿æœ€å°é«˜åº¦ */
            padding-bottom: 10px; /* åº•éƒ¨å†…è¾¹è· */
        }
        
        .message {
            max-width: 85%;
            padding: 15px; /* å‡å°å†…è¾¹è· */
            border-radius: 15px; /* å‡å°åœ†è§’ */
            line-height: 1.5;
            font-size: 0.9rem; /* å‡å°å­—ä½“ */
            position: relative;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .message.ai {
            align-self: flex-start;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(114, 9, 183, 0.1));
            color: #333;
            border-bottom-left-radius: 5px;
        }
        
        .message.user {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .message.system {
            align-self: center;
            background: rgba(76, 201, 240, 0.1);
            color: var(--success);
            font-size: 0.85rem; /* å‡å°å­—ä½“ */
            text-align: center;
            max-width: 90%;
            border: 1px solid rgba(76, 201, 240, 0.2);
        }
        
        /* æ»šåŠ¨åˆ°åº•éƒ¨æŒ‡ç¤ºå™¨ */
        .scroll-indicator {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.3s;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        .scroll-indicator:hover {
            opacity: 1;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(67, 97, 238, 0.4);
        }
        
        .scroll-indicator.hidden {
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
        }
        
        /* è¾“å…¥åŒºåŸŸ */
        .input-area {
            margin-top: auto;
        }
        
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-action-btn {
            padding: 10px 18px;
            background: rgba(67, 97, 238, 0.08);
            border: 2px solid rgba(67, 97, 238, 0.15);
            border-radius: 12px;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .quick-action-btn:hover {
            background: rgba(67, 97, 238, 0.15);
            transform: translateY(-2px);
        }
        
        .input-wrapper {
            display: flex;
            gap: 12px;
        }
        
        .message-input {
            flex: 1;
            padding: 16px 20px;
            background: white;
            border: 2px solid #eaeaea;
            border-radius: 15px;
            color: #333;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s;
            resize: none;
            min-height: 60px;
            max-height: 120px;
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .send-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ç”Ÿæˆçš„é¢˜ç›®é¢„è§ˆ */
        .questions-preview {
            margin-top: 25px;
            padding: 25px;
            background: rgba(67, 97, 238, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(67, 97, 238, 0.1);
            display: none;
        }
        
        .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .preview-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: #222;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .preview-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .preview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .preview-difficulty {
            font-size: 0.8rem;
            padding: 4px 12px;
            border-radius: 20px;
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            font-weight: 500;
        }
        
        .preview-content {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.5;
            margin: 10px 0;
        }
        
        .use-btn {
            width: 100%;
            padding: 10px;
            background: rgba(67, 97, 238, 0.1);
            border: 2px solid rgba(67, 97, 238, 0.2);
            border-radius: 10px;
            color: var(--primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .use-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .control-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .control-btn {
            flex: 1;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border: none;
            border-radius: 15px;
            color: white;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }
        
        .control-btn.secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .control-btn.secondary:hover {
            background: rgba(67, 97, 238, 0.05);
        }
        
        /* å³ä¾§ç»ƒä¹ åˆ—è¡¨å’Œé”™é¢˜æœ¬ */
        .practice-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        
        .practice-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #eaeaea;
            padding-bottom: 15px;
        }
        
        .practice-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .practice-tab.active {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }
        
        .practice-list {
            flex: 1;
            overflow-y: auto;
            max-height: 500px;
        }
        
        .question-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }
        
        .question-item:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.1);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .question-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .question-difficulty {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 500;
        }
        
        .difficulty-easy {
            background: rgba(76, 201, 240, 0.1);
            color: #4cc9f0;
        }
        
        .difficulty-medium {
            background: rgba(248, 37, 133, 0.1);
            color: #f72585;
        }
        
        .difficulty-hard {
            background: rgba(114, 9, 183, 0.1);
            color: #7209b7;
        }
        
        .question-type {
            font-size: 0.8rem;
            color: #666;
            background: #f5f5f5;
            padding: 4px 10px;
            border-radius: 15px;
        }
        
        .question-content {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .question-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn.primary {
            background: var(--primary);
            color: white;
        }
        
        .action-btn.secondary {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }
        
        .action-btn.warning {
            background: rgba(248, 37, 133, 0.1);
            color: #f72585;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-icon {
            font-size: 3rem;
            color: #eaeaea;
            margin-bottom: 15px;
        }
        
        /* ç¡®è®¤å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .modal-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #f72585, #7209b7);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-icon i {
            color: white;
            font-size: 1.5rem;
        }
        
        .modal-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #222;
        }
        
        .modal-body {
            margin-bottom: 30px;
        }
        
        .modal-text {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .warning-text {
            background: rgba(248, 37, 133, 0.1);
            border: 1px solid rgba(248, 37, 133, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: #f72585;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-btn.cancel {
            background: #f5f5f5;
            color: #666;
        }
        
        .modal-btn.cancel:hover {
            background: #eaeaea;
        }
        
        .modal-btn.confirm {
            background: linear-gradient(135deg, #f72585, #7209b7);
            color: white;
        }
        
        .modal-btn.confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(248, 37, 133, 0.3);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(67, 97, 238, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* é‡ç½®è¿›åº¦æŒ‡ç¤ºå™¨ */
        .reset-progress {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #eaeaea;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4361ee, #7209b7);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .three-column-layout {
                grid-template-columns: 1fr;
            }
            
            .preview-grid {
                grid-template-columns: 1fr;
            }
            
            .chat-container {
                max-height: 350px;
                min-height: 350px;
            }
        }
        
        @media (max-width: 768px) {
            .nav-container {
                padding: 0 20px;
            }
            
            .main-content {
                padding: 0 20px;
            }
            
            .nav-menu {
                display: none;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .control-buttons {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .practice-tabs {
                flex-direction: column;
            }
            
            .modal-content {
                padding: 30px 20px;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .chat-container {
                max-height: 300px;
                min-height: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .filter-panel, .ai-agent-panel, .practice-panel {
                padding: 20px;
            }
            
            .quick-actions {
                justify-content: center;
            }
            
            .quick-action-btn {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .question-actions {
                flex-direction: column;
            }
            
            .chat-container {
                max-height: 250px;
                min-height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- æ¸å˜èƒŒæ™¯ -->
    <div class="gradient-bg"></div>
    
    <!-- ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="modal-title" id="modalTitle">ç¡®è®¤é‡ç½®</div>
            </div>
            <div class="modal-body">
                <div class="modal-text" id="modalText">æ‚¨ç¡®å®šè¦é‡ç½®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚</div>
                <div class="warning-text" id="modalWarning">
                    <i class="fas fa-exclamation-circle"></i> è­¦å‘Šï¼šé‡ç½®åæ•°æ®å°†æ°¸ä¹…ä¸¢å¤±ï¼Œè¯·è°¨æ…æ“ä½œï¼
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn cancel" id="cancelReset">å–æ¶ˆ</button>
                <button class="modal-btn confirm" id="confirmReset">ç¡®è®¤é‡ç½®</button>
            </div>
        </div>
    </div>
    
    <!-- é‡ç½®è¿›åº¦å¼¹çª— -->
    <div class="modal-overlay" id="resetProgressModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <div class="modal-title">æ­£åœ¨é‡ç½®...</div>
            </div>
            <div class="modal-body">
                <div class="reset-progress" id="resetProgress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="modal-text" id="progressText">æ­£åœ¨é‡ç½®æ•°æ®...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-calculator"></i>
                </div>
                <span class="logo-text">æ•°å­¦æ˜Ÿæ²³</span>
            </a>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="æ•°å­¦å®‡å®™.html" class="nav-link active">
                        <i class="fas fa-brain"></i>
                        <span>é¦–é¡µ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="æ™ºæ…§å·¥åŠ.html" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>æ™ºæ…§å·¥åŠ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="å¤‡è€ƒå†²åˆº.html" class="nav-link">
                        <i class="fas fa-book"></i>
                        <span>å¤‡è€ƒå†²åˆº</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="å­¦ä¹ ç¤¾åŒº.html" class="nav-link">
                        <i class="fas fa-user-circle"></i>
                        <span>å­¦ä¹ ç¤¾åŒº</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    
    <!-- ä¸»å†…å®¹ -->
    <div class="main-content">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title">é«˜ä¸­æ•°å­¦æ™ºèƒ½é¢˜åº“</h1>
            <p class="page-subtitle">æµ·é‡é¢˜åº“ + AIæ™ºèƒ½æ¨èï¼Œä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„ï¼Œå…¨é¢æå‡æ•°å­¦èƒ½åŠ›</p>
        </div>
        
        <!-- ä¸‰æ å¸ƒå±€ -->
        <div class="three-column-layout">
            <!-- å·¦ä¾§ç­›é€‰é¢æ¿ -->
            <div class="filter-panel">
                <h2 class="panel-title">
                    <i class="fas fa-sliders-h"></i>
                    æ™ºèƒ½ç­›é€‰ä¸æ¨è
                </h2>
                
                <div class="filter-group">
                    <label class="filter-label">çŸ¥è¯†ç‚¹</label>
                    <select class="filter-select" id="knowledge-select">
                        <option value="all">å…¨éƒ¨çŸ¥è¯†ç‚¹</option>
                        <option value="function">å‡½æ•°ä¸å¯¼æ•°</option>
                        <option value="trigonometry">ä¸‰è§’å‡½æ•°</option>
                        <option value="sequence">æ•°åˆ—</option>
                        <option value="inequality">ä¸ç­‰å¼</option>
                        <option value="geometry">ç«‹ä½“å‡ ä½•</option>
                        <option value="analytic">è§£æå‡ ä½•</option>
                        <option value="probability">æ¦‚ç‡ä¸ç»Ÿè®¡</option>
                        <option value="calculus">å¯¼æ•°åˆæ­¥</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">éš¾åº¦</label>
                    <select class="filter-select" id="difficulty-select">
                        <option value="all">å…¨éƒ¨éš¾åº¦</option>
                        <option value="easy">åŸºç¡€</option>
                        <option value="medium">ä¸­ç­‰</option>
                        <option value="hard">è¿›é˜¶</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">é¢˜å‹</label>
                    <select class="filter-select" id="type-select">
                        <option value="all">å…¨éƒ¨é¢˜å‹</option>
                        <option value="choice">é€‰æ‹©é¢˜</option>
                        <option value="fill">å¡«ç©ºé¢˜</option>
                        <option value="answer">è§£ç­”é¢˜</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">é¢˜ç›®æ•°é‡</label>
                    <select class="filter-select" id="count-select">
                        <option value="5">5é¢˜</option>
                        <option value="10" selected>10é¢˜</option>
                        <option value="20">20é¢˜</option>
                        <option value="30">30é¢˜</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">AIæ¨èæ¨¡å¼</label>
                    <select class="filter-select" id="ai-mode">
                        <option value="weak">è–„å¼±çŸ¥è¯†ç‚¹çªç ´</option>
                        <option value="exam">é«˜è€ƒé«˜é¢‘è€ƒç‚¹</option>
                        <option value="mistake">é”™é¢˜é‡åš</option>
                        <option value="random">éšæœºæŒ‘æˆ˜</option>
                        <option value="simulate">æ¨¡æ‹Ÿè€ƒè¯•</option>
                    </select>
                </div>
                
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-questions">156</div>
                        <div class="stat-label">æ€»ç»ƒä¹ é¢˜ç›®</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="correct-rate">77%</div>
                        <div class="stat-label">æ­£ç¡®ç‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="wrong-count">36</div>
                        <div class="stat-label">é”™é¢˜æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="study-time">245</div>
                        <div class="stat-label">å­¦ä¹ æ—¶é•¿(åˆ†é’Ÿ)</div>
                    </div>
                </div>
                
                <!-- é‡ç½®åŠŸèƒ½åŒºåŸŸ -->
                <div class="reset-section">
                    <div class="reset-title">
                        <i class="fas fa-redo-alt"></i>
                        æ•°æ®é‡ç½®
                    </div>
                    <div class="reset-buttons">
                        <button class="reset-btn" id="reset-stats-btn">
                            <span>é‡ç½®ç»Ÿè®¡æ•°æ®</span>
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button class="reset-btn" id="reset-chat-btn">
                            <span>æ¸…ç©ºèŠå¤©è®°å½•</span>
                            <i class="fas fa-comments"></i>
                        </button>
                        <button class="reset-btn" id="reset-practice-btn">
                            <span>æ¸…ç©ºç»ƒä¹ æ•°æ®</span>
                            <i class="fas fa-book"></i>
                        </button>
                        <button class="reset-btn warning" id="reset-all-btn">
                            <span>é‡ç½®å…¨éƒ¨æ•°æ®</span>
                            <i class="fas fa-bomb"></i>
                        </button>
                    </div>
                </div>
                
                <!-- æ§åˆ¶æŒ‰é’® -->
                <div class="control-buttons">
                    <button class="control-btn" id="generate-btn">
                        <i class="fas fa-robot"></i>
                        AIæ™ºèƒ½ç»„é¢˜
                    </button>
                    <button class="control-btn secondary" id="practice-history-btn" onclick="window.open('http://127.0.0.1:5500/%E7%BB%83%E4%B9%A0%E5%8E%86%E5%8F%B2.html', '_blank')">
                        <i class="fas fa-history"></i>
                        ç»ƒä¹ å†å²
                    </button>
                </div>
            </div>
            
            <!-- ä¸­é—´AIæ™ºèƒ½ä½“é¢æ¿ -->
            <div class="ai-agent-panel">
                <div class="agent-header">
                    <div class="agent-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="agent-info">
                        <h3>æ•°å­¦æ˜Ÿæ²³AIå¯¼å¸ˆ</h3>
                        <div class="agent-status">
                            <i class="fas fa-circle"></i>
                            åœ¨çº¿ - å·²è¿æ¥æ‰£å­æ™ºèƒ½ä½“
                        </div>
                    </div>
                </div>
                
                <!-- èŠå¤©åŒºåŸŸ - æ·»åŠ æ»šåŠ¨æŒ‡ç¤ºå™¨ -->
                <div class="chat-container" id="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <!-- åˆå§‹æ¬¢è¿æ¶ˆæ¯ -->
                        <div class="message ai">
                            <strong>ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æ•°å­¦AIå¯¼å¸ˆ ğŸ‘‹</strong><br><br>
                            æˆ‘å¯ä»¥ä¸ºä½ ï¼š<br>
                            â€¢ <strong>æ™ºèƒ½ç»„é¢˜</strong> - ç”Ÿæˆä¸ªæ€§åŒ–ç»ƒä¹ é¢˜<br>
                            â€¢ <strong>åˆ†æè–„å¼±ç‚¹</strong> - æ‰¾å‡ºçŸ¥è¯†ç›²åŒº<br>
                            â€¢ <strong>å®šåˆ¶å­¦ä¹ è®¡åˆ’</strong> - è§„åˆ’é«˜æ•ˆè·¯å¾„<br>
                            â€¢ <strong>è§£ç­”æ•°å­¦ç–‘é—®</strong> - éšæ—¶ç­”ç–‘è§£æƒ‘<br><br>
                            å‘Šè¯‰æˆ‘ä½ çš„éœ€æ±‚ï¼Œæˆ–ç‚¹å‡»ä¸‹é¢çš„å¿«æ·æŒ‡ä»¤å¼€å§‹å­¦ä¹ ï¼
                        </div>
                    </div>
                    <!-- æ»šåŠ¨åˆ°åº•éƒ¨æŒ‡ç¤ºå™¨ -->
                    <div class="scroll-indicator hidden" id="scroll-indicator" title="æ»šåŠ¨åˆ°åº•éƒ¨">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                
                <!-- å¿«æ·æŒ‡ä»¤ -->
                <div class="quick-actions">
                    <button class="quick-action-btn" data-action="generate-easy">
                        ç”ŸæˆåŸºç¡€ç»ƒä¹ é¢˜
                    </button>
                    <button class="quick-action-btn" data-action="generate-medium">
                        ç”Ÿæˆä¸­ç­‰éš¾åº¦é¢˜
                    </button>
                    <button class="quick-action-btn" data-action="generate-hard">
                        ç”Ÿæˆè¿›é˜¶æŒ‘æˆ˜é¢˜
                    </button>
                    <button class="quick-action-btn" data-action="analyze-weakness">
                        åˆ†æè–„å¼±ç‚¹
                    </button>
                    <button class="quick-action-btn" data-action="exam-practice" onclick="window.open('http://127.0.0.1:5500/%E6%A8%A1%E6%8B%9F%E8%80%83%E8%AF%95.html', '_blank')">
                        æ¨¡æ‹Ÿè€ƒè¯•
                    </button>
                    <button class="quick-action-btn" data-action="explain-concept">
                        è®²è§£æ¦‚å¿µ
                    </button>
                </div>
                
                <!-- è¾“å…¥åŒºåŸŸ -->
                <div class="input-area">
                    <div class="input-wrapper">
                        <textarea class="message-input" id="message-input" 
                                  placeholder="è¾“å…¥ä½ çš„é—®é¢˜æˆ–å­¦ä¹ éœ€æ±‚..." 
                                  rows="1"></textarea>
                        <button class="send-btn" id="send-btn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <!-- ç”Ÿæˆçš„é¢˜ç›®é¢„è§ˆ -->
                <div class="questions-preview" id="questions-preview">
                    <div class="preview-header">
                        <div class="preview-title">
                            <i class="fas fa-lightbulb"></i>
                            AIæ™ºèƒ½ç”Ÿæˆçš„é¢˜ç›®
                        </div>
                        <button class="use-btn" id="use-all-btn" style="width: auto; padding: 8px 16px;">
                            ä½¿ç”¨å…¨éƒ¨é¢˜ç›®
                        </button>
                    </div>
                    <div class="preview-grid" id="preview-grid">
                        <!-- é¢˜ç›®é¢„è§ˆå¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ç»ƒä¹ åˆ—è¡¨å’Œé”™é¢˜æœ¬ -->
            <div class="practice-panel">
                <div class="practice-tabs">
                    <button class="practice-tab active" data-tab="practice-list">ç»ƒä¹ åˆ—è¡¨</button>
                    <button class="practice-tab" data-tab="wrong-questions">é”™é¢˜æœ¬</button>
                    <button class="practice-tab" data-tab="bookmarked">æ”¶è—é¢˜ç›®</button>
                </div>
                
                <div class="practice-list">
                    <!-- ç»ƒä¹ åˆ—è¡¨ -->
                    <div id="practice-list-content">
                        <div class="question-item">
                            <div class="question-header">
                                <h4 style="color: #222; font-size: 1rem;">å‡½æ•°ä¸å¯¼æ•°ç»¼åˆé¢˜</h4>
                                <span class="question-type">é€‰æ‹©é¢˜</span>
                            </div>
                            <div class="question-meta">
                                <span class="question-difficulty difficulty-medium">ä¸­ç­‰</span>
                                <span style="font-size: 0.8rem; color: #666;">15åˆ†é’Ÿå‰</span>
                            </div>
                            <div class="question-content">
                                å·²çŸ¥å‡½æ•°f(x)=xÂ³-3x+1ï¼Œæ±‚å‡½æ•°åœ¨åŒºé—´[-2,2]ä¸Šçš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚
                            </div>
                            <div class="question-actions">
                                <button class="action-btn primary" onclick="startPractice(1)">å¼€å§‹ç»ƒä¹ </button>
                                <button class="action-btn secondary" onclick="addToBookmark(1)">æ”¶è—</button>
                            </div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-header">
                                <h4 style="color: #222; font-size: 1rem;">ä¸‰è§’å‡½æ•°åŒ–ç®€</h4>
                                <span class="question-type">è§£ç­”é¢˜</span>
                            </div>
                            <div class="question-meta">
                                <span class="question-difficulty difficulty-easy">åŸºç¡€</span>
                                <span style="font-size: 0.8rem; color: #666;">1å°æ—¶å‰</span>
                            </div>
                            <div class="question-content">
                                åŒ–ç®€ï¼šsinÂ²x + cosÂ²x + 2sinxcosxï¼Œå¹¶æ±‚å½“x=Ï€/4æ—¶çš„å€¼ã€‚
                            </div>
                            <div class="question-actions">
                                <button class="action-btn primary" onclick="startPractice(2)">å¼€å§‹ç»ƒä¹ </button>
                                <button class="action-btn secondary" onclick="addToBookmark(2)">æ”¶è—</button>
                            </div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-header">
                                <h4 style="color: #222; font-size: 1rem;">æ•°åˆ—æ±‚å’Œé—®é¢˜</h4>
                                <span class="question-type">å¡«ç©ºé¢˜</span>
                            </div>
                            <div class="question-meta">
                                <span class="question-difficulty difficulty-hard">è¿›é˜¶</span>
                                <span style="font-size: 0.8rem; color: #666;">3å°æ—¶å‰</span>
                            </div>
                            <div class="question-content">
                                ç­‰å·®æ•°åˆ—{an}ä¸­ï¼Œaâ‚=3ï¼Œå…¬å·®d=2ï¼Œæ±‚å‰10é¡¹çš„å’ŒSâ‚â‚€ã€‚
                            </div>
                            <div class="question-actions">
                                <button class="action-btn primary" onclick="startPractice(3)">å¼€å§‹ç»ƒä¹ </button>
                                <button class="action-btn secondary" onclick="addToBookmark(3)">æ”¶è—</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- é”™é¢˜æœ¬ -->
                    <div id="wrong-questions-content" style="display: none;">
                        <div class="question-item">
                            <div class="question-header">
                                <h4 style="color: #222; font-size: 1rem;">è§£æå‡ ä½•ç›´çº¿æ–¹ç¨‹</h4>
                                <span class="question-type">é€‰æ‹©é¢˜</span>
                            </div>
                            <div class="question-meta">
                                <span class="question-difficulty difficulty-medium">ä¸­ç­‰</span>
                                <span style="font-size: 0.8rem; color: #f72585;">é”™è¯¯3æ¬¡</span>
                            </div>
                            <div class="question-content">
                                æ±‚è¿‡ç‚¹(1,2)ä¸”ä¸ç›´çº¿3x-4y+5=0å‚ç›´çš„ç›´çº¿æ–¹ç¨‹ã€‚
                            </div>
                            <div class="question-actions">
                                <button class="action-btn primary" onclick="reviewWrongQuestion(1)">é‡åš</button>
                                <button class="action-btn warning" onclick="removeFromWrong(1)">ç§»é™¤</button>
                            </div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-header">
                                <h4 style="color: #222; font-size: 1rem;">æ¦‚ç‡è®¡ç®—é—®é¢˜</h4>
                                <span class="question-type">è§£ç­”é¢˜</span>
                            </div>
                            <div class="question-meta">
                                <span class="question-difficulty difficulty-hard">è¿›é˜¶</span>
                                <span style="font-size: 0.8rem; color: #f72585;">é”™è¯¯2æ¬¡</span>
                            </div>
                            <div class="question-content">
                                ä»5ä¸ªçº¢çƒã€3ä¸ªç™½çƒä¸­éšæœºæŠ½å–3ä¸ªçƒï¼Œæ±‚è‡³å°‘æŠ½åˆ°1ä¸ªç™½çƒçš„æ¦‚ç‡ã€‚
                            </div>
                            <div class="question-actions">
                                <button class="action-btn primary" onclick="reviewWrongQuestion(2)">é‡åš</button>
                                <button class="action-btn warning" onclick="removeFromWrong(2)">ç§»é™¤</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ”¶è—é¢˜ç›® -->
                    <div id="bookmarked-content" style="display: none;">
                        <div class="question-item">
                            <div class="question-header">
                                <h4 style="color: #222; font-size: 1rem;">ç©ºé—´å‡ ä½•è¯æ˜</h4>
                                <span class="question-type">è§£ç­”é¢˜</span>
                            </div>
                            <div class="question-meta">
                                <span class="question-difficulty difficulty-hard">è¿›é˜¶</span>
                                <span style="font-size: 0.8rem; color: #666;">å·²æ”¶è—</span>
                            </div>
                            <div class="question-content">
                                åœ¨æ­£æ–¹ä½“ABCD-Aâ‚Bâ‚Câ‚Dâ‚ä¸­ï¼Œè¯æ˜ï¼šå¯¹è§’çº¿Aâ‚Cå‚ç›´äºå¹³é¢ABâ‚Dã€‚
                            </div>
                            <div class="question-actions">
                                <button class="action-btn primary" onclick="startPractice(4)">å¼€å§‹ç»ƒä¹ </button>
                                <button class="action-btn warning" onclick="removeBookmark(4)">å–æ¶ˆæ”¶è—</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æŸ¥çœ‹æ›´å¤šæŒ‰é’® -->
                <button class="control-btn secondary" style="margin-top: 20px;" onclick="window.open('http://127.0.0.1:5500/%E5%85%A8%E9%83%A8%E7%BB%83%E4%B9%A0.html', '_blank')">
                    <i class="fas fa-external-link-alt"></i>
                    æŸ¥çœ‹å…¨éƒ¨ç»ƒä¹ 
                </button>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        
        // æ™ºèƒ½ä½“é…ç½®
        const AI_AGENT_CONFIG = {
            apiKey: 'pat_F1M3MajAlXBV9aCoN7DWbAeeFaMZ1kP58GjKrLTSdWZkfRUNzq4bgKHuEXaWQE05',
            agentId: '7584093620417200128',
            apiEndpoint: 'https://api.coze.cn/v1/chat/completions',
            useMockMode: false
        };
        
        // ç”¨æˆ·å­¦ä¹ æ•°æ®
        let userStats = {
            totalQuestions: 156,
            correctAnswers: 120,
            wrongAnswers: 36,
            studyTime: 245,
            practiceHistory: [],
            wrongQuestions: [1, 2],
            bookmarkedQuestions: [4],
            lastActive: new Date().toISOString()
        };
        
        // æ™ºèƒ½ä½“çŠ¶æ€
        let agentState = {
            isConnected: true,
            isProcessing: false,
            messages: [],
            generatedQuestions: []
        };
        
        // ç»ƒä¹ æ•°æ®
        const practiceData = {
            practiceList: [
                {
                    id: 1,
                    title: "å‡½æ•°ä¸å¯¼æ•°ç»¼åˆé¢˜",
                    type: "é€‰æ‹©é¢˜",
                    difficulty: "medium",
                    content: "å·²çŸ¥å‡½æ•°f(x)=xÂ³-3x+1ï¼Œæ±‚å‡½æ•°åœ¨åŒºé—´[-2,2]ä¸Šçš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚",
                    timeAgo: "15åˆ†é’Ÿå‰",
                    knowledge: "å‡½æ•°ä¸å¯¼æ•°"
                },
                {
                    id: 2,
                    title: "ä¸‰è§’å‡½æ•°åŒ–ç®€",
                    type: "è§£ç­”é¢˜",
                    difficulty: "easy",
                    content: "åŒ–ç®€ï¼šsinÂ²x + cosÂ²x + 2sinxcosxï¼Œå¹¶æ±‚å½“x=Ï€/4æ—¶çš„å€¼ã€‚",
                    timeAgo: "1å°æ—¶å‰",
                    knowledge: "ä¸‰è§’å‡½æ•°"
                },
                {
                    id: 3,
                    title: "æ•°åˆ—æ±‚å’Œé—®é¢˜",
                    type: "å¡«ç©ºé¢˜",
                    difficulty: "hard",
                    content: "ç­‰å·®æ•°åˆ—{an}ä¸­ï¼Œaâ‚=3ï¼Œå…¬å·®d=2ï¼Œæ±‚å‰10é¡¹çš„å’ŒSâ‚â‚€ã€‚",
                    timeAgo: "3å°æ—¶å‰",
                    knowledge: "æ•°åˆ—"
                }
            ],
            wrongQuestions: [
                {
                    id: 1,
                    title: "è§£æå‡ ä½•ç›´çº¿æ–¹ç¨‹",
                    type: "é€‰æ‹©é¢˜",
                    difficulty: "medium",
                    content: "æ±‚è¿‡ç‚¹(1,2)ä¸”ä¸ç›´çº¿3x-4y+5=0å‚ç›´çš„ç›´çº¿æ–¹ç¨‹ã€‚",
                    wrongCount: 3,
                    knowledge: "è§£æå‡ ä½•"
                },
                {
                    id: 2,
                    title: "æ¦‚ç‡è®¡ç®—é—®é¢˜",
                    type: "è§£ç­”é¢˜",
                    difficulty: "hard",
                    content: "ä»5ä¸ªçº¢çƒã€3ä¸ªç™½çƒä¸­éšæœºæŠ½å–3ä¸ªçƒï¼Œæ±‚è‡³å°‘æŠ½åˆ°1ä¸ªç™½çƒçš„æ¦‚ç‡ã€‚",
                    wrongCount: 2,
                    knowledge: "æ¦‚ç‡ä¸ç»Ÿè®¡"
                }
            ],
            bookmarkedQuestions: [
                {
                    id: 4,
                    title: "ç©ºé—´å‡ ä½•è¯æ˜",
                    type: "è§£ç­”é¢˜",
                    difficulty: "hard",
                    content: "åœ¨æ­£æ–¹ä½“ABCD-Aâ‚Bâ‚Câ‚Dâ‚ä¸­ï¼Œè¯æ˜ï¼šå¯¹è§’çº¿Aâ‚Cå‚ç›´äºå¹³é¢ABâ‚Dã€‚",
                    knowledge: "ç«‹ä½“å‡ ä½•"
                }
            ]
        };
        
        // é‡ç½®ç›¸å…³å˜é‡
        let resetType = ''; // 'stats', 'chat', 'practice', 'all'
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateUserStats();
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // åˆå§‹åŒ–èŠå¤©åŒºåŸŸ
            initializeChat();
            
            // åŠ è½½ç»ƒä¹ æ•°æ®
            loadPracticeData();
            
            // åˆå§‹åŒ–ä»£ç é«˜äº®
            if (hljs) {
                hljs.highlightAll();
            }
        });
        
        // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡æ•°æ®
        function updateUserStats() {
            document.getElementById('total-questions').textContent = userStats.totalQuestions;
            
            const correctRate = userStats.totalQuestions > 0 
                ? Math.round((userStats.correctAnswers / userStats.totalQuestions) * 100) 
                : 0;
            document.getElementById('correct-rate').textContent = `${correctRate}%`;
            
            document.getElementById('wrong-count').textContent = userStats.wrongQuestions.length;
            document.getElementById('study-time').textContent = userStats.studyTime;
        }
        
        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // å‘é€æ¶ˆæ¯æŒ‰é’®
            document.getElementById('send-btn').addEventListener('click', sendMessage);
            
            // æ¶ˆæ¯è¾“å…¥æ¡†å›è½¦å‘é€
            document.getElementById('message-input').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // å¿«æ·æŒ‡ä»¤æŒ‰é’®
            document.querySelectorAll('.quick-action-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    if (this.getAttribute('data-action') === 'exam-practice') {
                        return;
                    }
                    const action = this.getAttribute('data-action');
                    handleQuickAction(action);
                });
            });
            
            // AIæ™ºèƒ½ç»„é¢˜æŒ‰é’®
            document.getElementById('generate-btn').addEventListener('click', function() {
                const knowledge = document.getElementById('knowledge-select').value;
                const difficulty = document.getElementById('difficulty-select').value;
                const type = document.getElementById('type-select').value;
                const count = document.getElementById('count-select').value;
                const mode = document.getElementById('ai-mode').value;
                
                const message = `è¯·ä¸ºæˆ‘ç”Ÿæˆ${count}é“${getChineseText(difficulty)}${getChineseText(knowledge)}${getChineseText(type)}ï¼Œæ¨èæ¨¡å¼ï¼š${getChineseText(mode)}`;
                handleUserMessage(message);
            });
            
            // ç»ƒä¹ æ ‡ç­¾åˆ‡æ¢
            document.querySelectorAll('.practice-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchPracticeTab(tabName);
                });
            });
            
            // ä½¿ç”¨å…¨éƒ¨é¢˜ç›®æŒ‰é’®
            document.getElementById('use-all-btn').addEventListener('click', useAllGeneratedQuestions);
            
            // é‡ç½®æŒ‰é’®äº‹ä»¶ç»‘å®š
            bindResetEvents();
            
            // ç»‘å®šæ»šåŠ¨æŒ‡ç¤ºå™¨ç‚¹å‡»äº‹ä»¶
            const indicator = document.getElementById('scroll-indicator');
            if (indicator) {
                indicator.addEventListener('click', scrollToBottom);
            }
        }
        
        // ç»‘å®šé‡ç½®äº‹ä»¶
        function bindResetEvents() {
            // é‡ç½®ç»Ÿè®¡æ•°æ®
            document.getElementById('reset-stats-btn').addEventListener('click', function() {
                showResetModal('stats', 'é‡ç½®ç»Ÿè®¡æ•°æ®', 'ç¡®å®šè¦é‡ç½®ç»Ÿè®¡æ•°æ®å—ï¼Ÿè¿™å°†æ¸…é™¤ä½ çš„æ€»ç»ƒä¹ é¢˜ç›®æ•°ã€æ­£ç¡®ç‡ã€é”™é¢˜æ•°é‡å’Œå­¦ä¹ æ—¶é•¿è®°å½•ã€‚');
            });
            
            // æ¸…ç©ºèŠå¤©è®°å½•
            document.getElementById('reset-chat-btn').addEventListener('click', function() {
                showResetModal('chat', 'æ¸…ç©ºèŠå¤©è®°å½•', 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿè¿™å°†åˆ é™¤ä½ ä¸AIå¯¼å¸ˆçš„æ‰€æœ‰å¯¹è¯å†å²ã€‚');
            });
            
            // æ¸…ç©ºç»ƒä¹ æ•°æ®
            document.getElementById('reset-practice-btn').addEventListener('click', function() {
                showResetModal('practice', 'æ¸…ç©ºç»ƒä¹ æ•°æ®', 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç»ƒä¹ æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤ç»ƒä¹ åˆ—è¡¨ã€é”™é¢˜æœ¬å’Œæ”¶è—é¢˜ç›®ä¸­çš„æ‰€æœ‰è®°å½•ã€‚');
            });
            
            // é‡ç½®å…¨éƒ¨æ•°æ®
            document.getElementById('reset-all-btn').addEventListener('click', function() {
                showResetModal('all', 'é‡ç½®å…¨éƒ¨æ•°æ®', 'ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†æ¸…é™¤ï¼š<br>1. ç»Ÿè®¡æ•°æ®<br>2. èŠå¤©è®°å½•<br>3. ç»ƒä¹ æ•°æ®<br>4. æ‰€æœ‰ä¸ªäººè®¾ç½®');
            });
            
            // å–æ¶ˆé‡ç½®
            document.getElementById('cancelReset').addEventListener('click', function() {
                hideResetModal();
            });
            
            // ç¡®è®¤é‡ç½®
            document.getElementById('confirmReset').addEventListener('click', function() {
                executeReset();
            });
        }
        
        // æ˜¾ç¤ºé‡ç½®ç¡®è®¤å¼¹çª—
        function showResetModal(type, title, text) {
            resetType = type;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').innerHTML = text;
            
            // æ ¹æ®é‡ç½®ç±»å‹è°ƒæ•´è­¦å‘Šæ–‡æœ¬
            let warningText = '';
            switch(type) {
                case 'stats':
                    warningText = 'é‡ç½®åç»Ÿè®¡æ•°æ®å°†å½’é›¶ï¼Œä½†ä¸ä¼šå½±å“å…¶ä»–æ•°æ®ã€‚';
                    break;
                case 'chat':
                    warningText = 'æ¸…ç©ºåèŠå¤©è®°å½•æ— æ³•æ¢å¤ï¼Œå»ºè®®å…ˆå¯¼å‡ºé‡è¦å¯¹è¯ã€‚';
                    break;
                case 'practice':
                    warningText = 'æ¸…ç©ºåæ‰€æœ‰ç»ƒä¹ è®°å½•ã€é”™é¢˜å’Œæ”¶è—å°†æ°¸ä¹…åˆ é™¤ã€‚';
                    break;
                case 'all':
                    warningText = 'é‡ç½®åæ‰€æœ‰æ•°æ®å°†æ°¸ä¹…ä¸¢å¤±ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼';
                    break;
            }
            
            document.getElementById('modalWarning').innerHTML = 
                `<i class="fas fa-exclamation-circle"></i> è­¦å‘Šï¼š${warningText}`;
            
            document.getElementById('resetModal').style.display = 'flex';
        }
        
        // éšè—é‡ç½®å¼¹çª—
        function hideResetModal() {
            document.getElementById('resetModal').style.display = 'none';
            resetType = '';
        }
        
        // æ‰§è¡Œé‡ç½®æ“ä½œ
        async function executeReset() {
            hideResetModal();
            
            // æ˜¾ç¤ºè¿›åº¦å¼¹çª—
            showResetProgress();
            
            // æ¨¡æ‹Ÿé‡ç½®è¿›åº¦
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 25;
                updateProgress(progress, getProgressText(progress));
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    
                    // æ ¹æ®ç±»å‹æ‰§è¡Œé‡ç½®
                    switch(resetType) {
                        case 'stats':
                            resetStatistics();
                            break;
                        case 'chat':
                            resetChatHistory();
                            break;
                        case 'practice':
                            resetPracticeData();
                            break;
                        case 'all':
                            resetAllData();
                            break;
                    }
                    
                    // æ˜¾ç¤ºå®Œæˆæç¤º
                    setTimeout(() => {
                        hideResetProgress();
                        showNotification('é‡ç½®å®Œæˆï¼');
                    }, 500);
                }
            }, 200);
        }
        
        // é‡ç½®ç»Ÿè®¡æ•°æ®
        function resetStatistics() {
            userStats = {
                totalQuestions: 0,
                correctAnswers: 0,
                wrongAnswers: 0,
                studyTime: 0,
                practiceHistory: [],
                wrongQuestions: [],
                bookmarkedQuestions: [],
                lastActive: new Date().toISOString()
            };
            
            saveUserData();
            updateUserStats();
            
            // åˆ·æ–°é¡µé¢æ˜¾ç¤º
            loadPracticeData();
        }
        
        // é‡ç½®èŠå¤©è®°å½•
        function resetChatHistory() {
            agentState.messages = [];
            document.getElementById('chat-messages').innerHTML = `
                <div class="message ai">
                    <strong>ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æ•°å­¦AIå¯¼å¸ˆ ğŸ‘‹</strong><br><br>
                    æˆ‘å¯ä»¥ä¸ºä½ ï¼š<br>
                    â€¢ <strong>æ™ºèƒ½ç»„é¢˜</strong> - ç”Ÿæˆä¸ªæ€§åŒ–ç»ƒä¹ é¢˜<br>
                    â€¢ <strong>åˆ†æè–„å¼±ç‚¹</strong> - æ‰¾å‡ºçŸ¥è¯†ç›²åŒº<br>
                    â€¢ <strong>å®šåˆ¶å­¦ä¹ è®¡åˆ’</strong> - è§„åˆ’é«˜æ•ˆè·¯å¾„<br>
                    â€¢ <strong>è§£ç­”æ•°å­¦ç–‘é—®</strong> - éšæ—¶ç­”ç–‘è§£æƒ‘<br><br>
                    å‘Šè¯‰æˆ‘ä½ çš„éœ€æ±‚ï¼Œæˆ–ç‚¹å‡»ä¸‹é¢çš„å¿«æ·æŒ‡ä»¤å¼€å§‹å­¦ä¹ ï¼
                </div>
            `;
            
            localStorage.removeItem('mathChatHistory');
            
            // éšè—å¯èƒ½å­˜åœ¨çš„é¢˜ç›®é¢„è§ˆ
            document.getElementById('questions-preview').style.display = 'none';
        }
        
        // é‡ç½®ç»ƒä¹ æ•°æ®
        function resetPracticeData() {
            practiceData.practiceList = [];
            practiceData.wrongQuestions = [];
            practiceData.bookmarkedQuestions = [];
            
            // æ›´æ–°ç”¨æˆ·æ•°æ®
            userStats.wrongQuestions = [];
            userStats.bookmarkedQuestions = [];
            
            saveUserData();
            
            // åˆ·æ–°æ˜¾ç¤º
            updatePracticeDisplay();
            updateUserStats();
            
            // æ¸…ç©ºç»ƒä¹ åˆ—è¡¨æ˜¾ç¤º
            const contents = ['practice-list-content', 'wrong-questions-content', 'bookmarked-content'];
            contents.forEach(contentId => {
                const element = document.getElementById(contentId);
                if (element) {
                    element.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-inbox"></i>
                            </div>
                            <p>æš‚æ— æ•°æ®</p>
                        </div>
                    `;
                }
            });
        }
        
        // é‡ç½®æ‰€æœ‰æ•°æ®
        function resetAllData() {
            resetStatistics();
            resetChatHistory();
            resetPracticeData();
            
            // é‡ç½®ç­›é€‰å™¨åˆ°é»˜è®¤å€¼
            document.getElementById('knowledge-select').value = 'all';
            document.getElementById('difficulty-select').value = 'all';
            document.getElementById('type-select').value = 'all';
            document.getElementById('count-select').value = '10';
            document.getElementById('ai-mode').value = 'weak';
            
            // æ¸…ç©ºæ‰€æœ‰æœ¬åœ°å­˜å‚¨
            localStorage.clear();
            
            // é‡ç½®AIç”Ÿæˆçš„é¢˜ç›®
            agentState.generatedQuestions = [];
        }
        
        // æ˜¾ç¤ºé‡ç½®è¿›åº¦
        function showResetProgress() {
            document.getElementById('resetProgressModal').style.display = 'flex';
            document.getElementById('resetProgress').style.display = 'block';
        }
        
        // éšè—é‡ç½®è¿›åº¦
        function hideResetProgress() {
            document.getElementById('resetProgressModal').style.display = 'none';
            document.getElementById('resetProgress').style.display = 'none';
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percent, text) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            if (progressFill) {
                progressFill.style.width = `${percent}%`;
            }
            
            if (progressText) {
                progressText.textContent = text;
            }
        }
        
        // è·å–è¿›åº¦æ–‡æœ¬
        function getProgressText(percent) {
            if (percent < 25) return 'æ­£åœ¨å‡†å¤‡é‡ç½®...';
            if (percent < 50) return 'æ­£åœ¨å¤‡ä»½æ•°æ®...';
            if (percent < 75) return 'æ­£åœ¨æ¸…é™¤æ•°æ®...';
            return 'æ­£åœ¨é‡æ–°åˆå§‹åŒ–...';
        }
        
        // è·å–ä¸­æ–‡æ–‡æœ¬
        function getChineseText(key) {
            const map = {
                'all': 'å…¨éƒ¨',
                'easy': 'åŸºç¡€',
                'medium': 'ä¸­ç­‰',
                'hard': 'è¿›é˜¶',
                'function': 'å‡½æ•°ä¸å¯¼æ•°',
                'trigonometry': 'ä¸‰è§’å‡½æ•°',
                'sequence': 'æ•°åˆ—',
                'inequality': 'ä¸ç­‰å¼',
                'geometry': 'ç«‹ä½“å‡ ä½•',
                'analytic': 'è§£æå‡ ä½•',
                'probability': 'æ¦‚ç‡ä¸ç»Ÿè®¡',
                'calculus': 'å¾®ç§¯åˆ†åˆæ­¥',
                'choice': 'é€‰æ‹©é¢˜',
                'fill': 'å¡«ç©ºé¢˜',
                'answer': 'è§£ç­”é¢˜',
                'weak': 'è–„å¼±çŸ¥è¯†ç‚¹çªç ´',
                'exam': 'é«˜è€ƒé«˜é¢‘è€ƒç‚¹',
                'mistake': 'é”™é¢˜é‡åš',
                'random': 'éšæœºæŒ‘æˆ˜',
                'simulate': 'æ¨¡æ‹Ÿè€ƒè¯•'
            };
            return map[key] || key;
        }
        
        // åˆå§‹åŒ–èŠå¤©
        function initializeChat() {
            loadChatHistory();
            
            // ç»‘å®šæ»šåŠ¨äº‹ä»¶
            const container = document.getElementById('chat-container');
            if (container) {
                container.addEventListener('scroll', updateScrollIndicator);
            }
            
            // åˆå§‹æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                scrollToBottom();
                updateScrollIndicator();
            }, 300);
        }
        
        // æ›´æ–°æ»šåŠ¨æŒ‡ç¤ºå™¨çŠ¶æ€
        function updateScrollIndicator() {
            const container = document.getElementById('chat-container');
            const indicator = document.getElementById('scroll-indicator');
            
            if (!container || !indicator) return;
            
            // è®¡ç®—æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆç•™20åƒç´ çš„å®¹å·®ï¼‰
            const isAtBottom = container.scrollHeight - container.scrollTop - container.clientHeight < 20;
            
            if (isAtBottom) {
                indicator.classList.add('hidden');
            } else {
                indicator.classList.remove('hidden');
            }
        }
        
        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message || agentState.isProcessing) return;
            
            handleUserMessage(message);
            input.value = '';
            input.style.height = 'auto';
        }
        
        // å¤„ç†ç”¨æˆ·æ¶ˆæ¯
        async function handleUserMessage(message) {
            addMessageToChat('user', message);
            
            agentState.messages.push({
                role: 'user',
                content: message,
                timestamp: new Date().toISOString()
            });
            
            showTypingIndicator();
            
            try {
                const response = await callCozeAPI(message);
                removeTypingIndicator();
                
                addMessageToChat('ai', response.content);
                
                agentState.messages.push({
                    role: 'assistant',
                    content: response.content,
                    timestamp: new Date().toISOString()
                });
                
                if (response.questions && response.questions.length > 0) {
                    displayGeneratedQuestions(response.questions);
                }
                
                saveChatHistory();
                
            } catch (error) {
                removeTypingIndicator();
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                
                // ä½¿ç”¨æ¨¡æ‹Ÿå“åº”
                const mockResponse = generateMockResponse(message);
                addMessageToChat('ai', mockResponse.content);
                
                if (mockResponse.questions && mockResponse.questions.length > 0) {
                    displayGeneratedQuestions(mockResponse.questions);
                }
            }
        }
        
        // è°ƒç”¨æ‰£å­API
        async function callCozeAPI(message) {
            if (AI_AGENT_CONFIG.useMockMode) {
                return generateMockResponse(message);
            }
            
            try {
                const response = await fetch(AI_AGENT_CONFIG.apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AI_AGENT_CONFIG.apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        agent_id: AI_AGENT_CONFIG.agentId,
                        messages: [{
                            role: 'user',
                            content: message
                        }],
                        stream: false
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIå“åº”é”™è¯¯: ${response.status}`);
                }
                
                const data = await response.json();
                
                return {
                    content: data.choices?.[0]?.message?.content || 'æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œè¯·ç¨ç­‰...',
                    questions: extractQuestionsFromResponse(data.choices?.[0]?.message?.content || '')
                };
                
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                throw error;
            }
        }
        
        // ä»å“åº”ä¸­æå–é¢˜ç›®
        function extractQuestionsFromResponse(content) {
            const questionPatterns = [
                /é¢˜ç›®\d+:([^]+?)(?=é¢˜ç›®\d+:|$)/g,
                /\d+\.([^]+?)(?=\d+\.|$)/g,
                /ã€é¢˜ç›®ã€‘([^]+?)(?=ã€é¢˜ç›®ã€‘|$)/g
            ];
            
            let questions = [];
            
            for (const pattern of questionPatterns) {
                const matches = content.match(pattern);
                if (matches && matches.length > 0) {
                    questions = matches.map((match, index) => ({
                        id: `api_${Date.now()}_${index}`,
                        content: match.trim(),
                        difficulty: 'medium',
                        type: 'ç»¼åˆé¢˜',
                        points: 10
                    }));
                    break;
                }
            }
            
            return questions.slice(0, 3);
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿå“åº”
        function generateMockResponse(message) {
            const lowerMessage = message.toLowerCase();
            let content = '';
            let questions = [];
            
            if (lowerMessage.includes('åŸºç¡€') || lowerMessage.includes('ç®€å•')) {
                content = 'æˆ‘ä¸ºä½ ç”Ÿæˆäº†ä¸€å¥—åŸºç¡€ç»ƒä¹ é¢˜ã€‚è¿™å¥—é¢˜ç›®ä¸»è¦è€ƒå¯Ÿé«˜ä¸­æ•°å­¦çš„åŸºç¡€æ¦‚å¿µå’Œè®¡ç®—èƒ½åŠ›ï¼Œé€‚åˆå·©å›ºåŸºç¡€çŸ¥è¯†ã€‚\n\n';
                content += 'é¢˜ç›®1: å·²çŸ¥äºŒæ¬¡å‡½æ•°f(x)=xÂ²-4x+3ï¼Œæ±‚å‡½æ•°çš„é¡¶ç‚¹åæ ‡å’Œå¯¹ç§°è½´æ–¹ç¨‹ã€‚\n\n';
                content += 'é¢˜ç›®2: è®¡ç®—ï¼šsin30Â° + cos60Â° + tan45Â°\n\n';
                content += 'é¢˜ç›®3: è§£ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ï¼šxÂ²-5x+6=0';
                questions = generateMockQuestions('easy', 3);
            } else if (lowerMessage.includes('ä¸­ç­‰') || lowerMessage.includes('å¸¸è§„')) {
                content = 'æˆ‘ä¸ºä½ å‡†å¤‡äº†ä¸€å¥—ä¸­ç­‰éš¾åº¦çš„ç»ƒä¹ é¢˜ã€‚è¿™äº›é¢˜ç›®éœ€è¦ä¸€å®šçš„æ€è€ƒå’Œæ¨ç†èƒ½åŠ›ï¼Œé€‚åˆæå‡è§£é¢˜æŠ€å·§ã€‚\n\n';
                content += 'é¢˜ç›®1: å·²çŸ¥å‡½æ•°f(x)=ln(x+1)ï¼Œæ±‚f\'(x)å¹¶è®¡ç®—f\'(0)çš„å€¼ã€‚\n\n';
                content += 'é¢˜ç›®2: åœ¨â–³ABCä¸­ï¼Œå·²çŸ¥a=3, b=4, âˆ C=60Â°ï¼Œæ±‚cè¾¹çš„é•¿åº¦ã€‚\n\n';
                content += 'é¢˜ç›®3: ç­‰å·®æ•°åˆ—{an}ä¸­ï¼Œaâ‚ƒ=7, aâ‚‡=15ï¼Œæ±‚aâ‚å’Œå…¬å·®dã€‚';
                questions = generateMockQuestions('medium', 3);
            } else if (lowerMessage.includes('è¿›é˜¶') || lowerMessage.includes('æŒ‘æˆ˜') || lowerMessage.includes('å›°éš¾')) {
                content = 'è¿™æ˜¯ä¸€å¥—è¿›é˜¶æŒ‘æˆ˜é¢˜ï¼Œé¢˜ç›®éš¾åº¦è¾ƒé«˜ï¼Œéœ€è¦ç»¼åˆè¿ç”¨å¤šä¸ªçŸ¥è¯†ç‚¹ã€‚é€‚åˆæƒ³è¦çªç ´è‡ªå·±çš„åŒå­¦ã€‚\n\n';
                content += 'é¢˜ç›®1: è¯æ˜ï¼šå¯¹äºä»»æ„x>0ï¼Œæœ‰e^x > 1 + x + xÂ²/2ã€‚\n\n';
                content += 'é¢˜ç›®2: æ±‚å‡½æ•°f(x)=xÂ³-6xÂ²+9xåœ¨åŒºé—´[0,4]ä¸Šçš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚\n\n';
                content += 'é¢˜ç›®3: å·²çŸ¥ç©ºé—´å››ç‚¹A(1,0,0), B(0,1,0), C(0,0,1), D(1,1,1)ï¼Œæ±‚å››é¢ä½“ABCDçš„ä½“ç§¯ã€‚';
                questions = generateMockQuestions('hard', 3);
            } else if (lowerMessage.includes('è–„å¼±') || lowerMessage.includes('å¼±ç‚¹')) {
                content = 'æ ¹æ®ä½ çš„å­¦ä¹ è®°å½•ï¼Œæˆ‘åˆ†æäº†ä½ çš„è–„å¼±çŸ¥è¯†ç‚¹ï¼š\n\n';
                content += '1. ä¸‰è§’å‡½æ•°å…¬å¼åº”ç”¨ï¼ˆé”™è¯¯ç‡45%ï¼‰\n';
                content += '2. æ•°åˆ—æ±‚å’ŒæŠ€å·§ï¼ˆé”™è¯¯ç‡38%ï¼‰\n';
                content += '3. ç©ºé—´å‡ ä½•è¯æ˜ï¼ˆé”™è¯¯ç‡52%ï¼‰\n\n';
                content += 'å»ºè®®å­¦ä¹ è®¡åˆ’ï¼š\n';
                content += 'â€¢ æœ¬å‘¨é‡ç‚¹å¤ä¹ ä¸‰è§’å‡½æ•°æ’ç­‰å˜æ¢\n';
                content += 'â€¢ æ¯å¤©ç»ƒä¹ 2é“æ•°åˆ—ç»¼åˆé¢˜\n';
                content += 'â€¢ è§‚çœ‹ç©ºé—´å‡ ä½•è¯æ˜ä¸“é¢˜è§†é¢‘';
            } else if (lowerMessage.includes('è€ƒè¯•') || lowerMessage.includes('æ¨¡æ‹Ÿ')) {
                content = 'ç°åœ¨å¼€å§‹æ¨¡æ‹Ÿè€ƒè¯•ç»ƒä¹ ã€‚è¯·å‡†å¤‡å¥½çº¸ç¬”ï¼Œåœ¨90åˆ†é’Ÿå†…å®Œæˆä»¥ä¸‹é¢˜ç›®ï¼š\n\n';
                content += 'ä¸€ã€é€‰æ‹©é¢˜ï¼ˆæ¯é¢˜5åˆ†ï¼Œå…±30åˆ†ï¼‰\n';
                content += '1. å‡½æ•°y=2x-3çš„å›¾åƒä¸xè½´çš„äº¤ç‚¹åæ ‡æ˜¯ï¼Ÿ\n\n';
                content += 'äºŒã€å¡«ç©ºé¢˜ï¼ˆæ¯é¢˜5åˆ†ï¼Œå…±20åˆ†ï¼‰\n';
                content += '1. è‹¥sinÎ¸=3/5ï¼Œä¸”Î¸åœ¨ç¬¬äºŒè±¡é™ï¼Œåˆ™cosÎ¸=____\n\n';
                content += 'ä¸‰ã€è§£ç­”é¢˜ï¼ˆå…±50åˆ†ï¼‰\n';
                content += '1. å·²çŸ¥å‡½æ•°f(x)=xÂ³-3xÂ²+2ï¼Œæ±‚å‡½æ•°çš„å•è°ƒåŒºé—´å’Œæå€¼ã€‚';
                questions = generateMockQuestions('mixed', 5);
            } else if (lowerMessage.includes('è®²è§£') || lowerMessage.includes('æ¦‚å¿µ')) {
                content = 'æˆ‘å¾ˆä¹æ„ä¸ºæ‚¨è®²è§£æ•°å­¦æ¦‚å¿µã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³äº†è§£çš„å…·ä½“çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚ï¼š\n\n';
                content += 'â€¢ å¯¼æ•°ä¸å‡½æ•°å•è°ƒæ€§çš„å…³ç³»\n';
                content += 'â€¢ ä¸‰è§’å‡½æ•°å’Œå·®åŒ–ç§¯å…¬å¼\n';
                content += 'â€¢ ç©ºé—´å‘é‡çš„æ•°é‡ç§¯\n';
                content += 'â€¢ æ¡ä»¶æ¦‚ç‡è®¡ç®—å…¬å¼\n';
                content += 'â€¢ æ•°åˆ—æé™çš„æ±‚æ³•\n\n';
                content += 'è¯·é€‰æ‹©å…¶ä¸­ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œæˆ‘ä¼šè¯¦ç»†è®²è§£ã€‚';
            } else {
                content = `æˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼š"${message}"\n\nä½œä¸ºä½ çš„æ•°å­¦AIå¯¼å¸ˆï¼Œæˆ‘å¯ä»¥ä¸ºä½ æä¾›ä¸ªæ€§åŒ–çš„å­¦ä¹ å»ºè®®å’Œé¢˜ç›®æ¨èã€‚`;
                questions = generateMockQuestions('mixed', 2);
            }
            
            if (questions.length > 0) {
                content += '\n\næˆ‘å·²ç»ä¸ºä½ ç”Ÿæˆäº†ç»ƒä¹ é¢˜ï¼Œè¯·æŸ¥çœ‹ä¸‹æ–¹çš„é¢˜ç›®é¢„è§ˆã€‚';
                agentState.generatedQuestions = questions;
            }
            
            return { content, questions };
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿé¢˜ç›®
        function generateMockQuestions(difficulty, count) {
            const questions = [];
            const knowledgeMap = {
                'function': 'å‡½æ•°ä¸å¯¼æ•°',
                'trigonometry': 'ä¸‰è§’å‡½æ•°',
                'sequence': 'æ•°åˆ—',
                'inequality': 'ä¸ç­‰å¼',
                'geometry': 'ç«‹ä½“å‡ ä½•',
                'analytic': 'è§£æå‡ ä½•',
                'probability': 'æ¦‚ç‡ä¸ç»Ÿè®¡',
                'calculus': 'å¾®ç§¯åˆ†åˆæ­¥'
            };
            
            const difficulties = difficulty === 'mixed' 
                ? ['easy', 'medium', 'hard']
                : [difficulty];
            
            const questionTypes = ['é€‰æ‹©é¢˜', 'å¡«ç©ºé¢˜', 'è§£ç­”é¢˜'];
            const questionExamples = [
                'å·²çŸ¥å‡½æ•°f(x)=xÂ²-2x+1ï¼Œæ±‚f(x)çš„æœ€å°å€¼',
                'åœ¨â–³ABCä¸­ï¼Œå·²çŸ¥sinA=3/5ï¼ŒcosB=5/13ï¼Œæ±‚sinCçš„å€¼',
                'ç­‰å·®æ•°åˆ—{an}ä¸­ï¼Œaâ‚=2ï¼Œå…¬å·®d=3ï¼Œæ±‚aâ‚â‚€çš„å€¼',
                'è§£ä¸ç­‰å¼ï¼š2xÂ²-5x+3>0',
                'å·²çŸ¥æ­£æ–¹ä½“ABCD-Aâ‚Bâ‚Câ‚Dâ‚çš„æ£±é•¿ä¸º2ï¼Œæ±‚å¼‚é¢ç›´çº¿ABâ‚ä¸BCâ‚çš„è·ç¦»',
                'æ±‚è¿‡ç‚¹(2,3)ä¸”ä¸ç›´çº¿x+y=1å‚ç›´çš„ç›´çº¿æ–¹ç¨‹',
                'ä»5ä¸ªä¸åŒçš„çƒä¸­ä»»å–3ä¸ªï¼Œæ±‚å–åˆ°ç‰¹å®š2ä¸ªçƒçš„æ¦‚ç‡',
                'æ±‚å‡½æ•°f(x)=e^x sinxçš„å¯¼æ•°',
                'è®¡ç®—å®šç§¯åˆ†ï¼šâˆ«â‚€Â¹ xÂ² dx',
                'å·²çŸ¥å‘é‡a=(1,2,3), b=(4,5,6)ï¼Œæ±‚aÂ·b'
            ];
            
            for (let i = 0; i < count; i++) {
                const knowledgeKeys = Object.keys(knowledgeMap);
                const randomKnowledge = knowledgeKeys[Math.floor(Math.random() * knowledgeKeys.length)];
                const randomDifficulty = difficulties[Math.floor(Math.random() * difficulties.length)];
                const randomType = questionTypes[Math.floor(Math.random() * questionTypes.length)];
                
                const difficultyText = {
                    'easy': 'åŸºç¡€',
                    'medium': 'ä¸­ç­‰',
                    'hard': 'è¿›é˜¶'
                }[randomDifficulty];
                
                questions.push({
                    id: `q_${Date.now()}_${i}`,
                    knowledge: randomKnowledge,
                    knowledgeText: knowledgeMap[randomKnowledge],
                    difficulty: randomDifficulty,
                    difficultyText: difficultyText,
                    type: randomType,
                    content: questionExamples[i % questionExamples.length],
                    answer: 'æŸ¥çœ‹è§£æ',
                    points: (i + 1) * 5
                });
            }
            
            return questions;
        }
        
        // å¤„ç†å¿«æ·æŒ‡ä»¤
        function handleQuickAction(action) {
            let message = '';
            
            switch (action) {
                case 'generate-easy':
                    message = 'è¯·ä¸ºæˆ‘ç”Ÿæˆä¸€äº›åŸºç¡€éš¾åº¦çš„æ•°å­¦ç»ƒä¹ é¢˜';
                    break;
                case 'generate-medium':
                    message = 'è¯·ä¸ºæˆ‘ç”Ÿæˆä¸­ç­‰éš¾åº¦çš„æ•°å­¦ç»ƒä¹ é¢˜';
                    break;
                case 'generate-hard':
                    message = 'è¯·ä¸ºæˆ‘ç”Ÿæˆè¿›é˜¶æŒ‘æˆ˜éš¾åº¦çš„æ•°å­¦ç»ƒä¹ é¢˜';
                    break;
                case 'analyze-weakness':
                    message = 'è¯·åˆ†æä¸€ä¸‹æˆ‘çš„å­¦ä¹ è–„å¼±ç‚¹ï¼Œå¹¶æä¾›æ”¹è¿›å»ºè®®';
                    break;
                case 'explain-concept':
                    message = 'è¯·ä¸ºæˆ‘è®²è§£å¯¼æ•°ä¸å‡½æ•°å•è°ƒæ€§çš„å…³ç³»';
                    break;
                default:
                    message = action;
            }
            
            document.getElementById('message-input').value = message;
            sendMessage();
        }
        
        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©
        function addMessageToChat(role, content) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            // é™åˆ¶å†…å®¹é•¿åº¦ï¼Œé˜²æ­¢æ¶ˆæ¯è¿‡é•¿
            let formattedContent = content;
            if (content.length > 800) {
                formattedContent = content.substring(0, 800) + "... [å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­]";
            }
            
            formattedContent = formattedContent
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/\d\.\s/g, '<br>$&');
            
            messageDiv.innerHTML = formattedContent;
            chatMessages.appendChild(messageDiv);
            
            // æ·»åŠ æ–°æ¶ˆæ¯åæ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                scrollToBottom();
                updateScrollIndicator();
            }, 100);
        }
        
        // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥çŠ¶æ€
        function showTypingIndicator() {
            const chatMessages = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="display: flex; gap: 4px;">
                        <div style="width: 6px; height: 6px; background: #4361ee; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both;"></div>
                        <div style="width: 6px; height: 6px; background: #4361ee; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; animation-delay: 0.2s;"></div>
                        <div style="width: 6px; height: 6px; background: #4361ee; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; animation-delay: 0.4s;"></div>
                    </div>
                    <span style="color: #666;">AIæ­£åœ¨æ€è€ƒ...</span>
                </div>
                <style>
                    @keyframes typing {
                        0%, 60%, 100% { transform: translateY(0); opacity: 0.3; }
                        30% { transform: translateY(-5px); opacity: 1; }
                    }
                </style>
            `;
            
            chatMessages.appendChild(typingDiv);
            
            // æ˜¾ç¤ºè¾“å…¥çŠ¶æ€æ—¶ä¹Ÿæ›´æ–°æ»šåŠ¨
            setTimeout(() => {
                scrollToBottom();
                updateScrollIndicator();
            }, 100);
        }
        
        // ç§»é™¤è¾“å…¥çŠ¶æ€
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // æ»šåŠ¨åˆ°åº•éƒ¨
        function scrollToBottom() {
            const container = document.getElementById('chat-container');
            if (container) {
                container.scrollTop = container.scrollHeight;
            }
        }
        
        // æ˜¾ç¤ºç”Ÿæˆçš„é¢˜ç›®
        function displayGeneratedQuestions(questions) {
            const previewContainer = document.getElementById('questions-preview');
            const previewGrid = document.getElementById('preview-grid');
            
            if (!previewContainer || !previewGrid) return;
            
            previewContainer.style.display = 'block';
            previewGrid.innerHTML = '';
            
            questions.forEach((question, index) => {
                const previewCard = document.createElement('div');
                previewCard.className = 'preview-card';
                previewCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <span class="preview-difficulty">${question.difficultyText}</span>
                        <span style="font-size: 0.8rem; color: #666;">${question.knowledgeText}</span>
                    </div>
                    <div class="preview-content">
                        <strong>é¢˜ç›® ${index + 1}</strong>: ${question.content}
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                        <span style="font-size: 0.8rem; color: #666;">${question.type} â€¢ ${question.points}åˆ†</span>
                        <button class="use-btn" data-question-id="${question.id}" style="width: auto; padding: 8px 16px;">
                            ä½¿ç”¨æ­¤é¢˜
                        </button>
                    </div>
                `;
                
                previewGrid.appendChild(previewCard);
            });
            
            // ç»‘å®šä½¿ç”¨æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.use-btn[data-question-id]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const questionId = this.getAttribute('data-question-id');
                    useGeneratedQuestion(questionId, questions);
                });
            });
            
            previewContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // ä½¿ç”¨å•ä¸ªç”Ÿæˆçš„é¢˜ç›®
        function useGeneratedQuestion(questionId, questions) {
            const question = questions.find(q => q.id === questionId);
            if (question) {
                // æ·»åŠ åˆ°ç»ƒä¹ åˆ—è¡¨
                addToPracticeList(question);
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                addMessageToChat('system', `å·²å°†é¢˜ç›®æ·»åŠ åˆ°ç»ƒä¹ åˆ—è¡¨ï¼š${question.content.substring(0, 50)}...`);
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                userStats.totalQuestions++;
                updateUserStats();
                
                // ä¿å­˜æ•°æ®
                saveUserData();
                
                // æ˜¾ç¤ºé€šçŸ¥
                showNotification('é¢˜ç›®å·²æ·»åŠ åˆ°ç»ƒä¹ åˆ—è¡¨ï¼');
                
                // é‡æ–°åŠ è½½ç»ƒä¹ æ•°æ®
                loadPracticeData();
            }
        }
        
        // ä½¿ç”¨æ‰€æœ‰ç”Ÿæˆçš„é¢˜ç›®
        function useAllGeneratedQuestions() {
            if (agentState.generatedQuestions.length === 0) return;
            
            // å°†æ‰€æœ‰é¢˜ç›®æ·»åŠ åˆ°ç»ƒä¹ åˆ—è¡¨
            agentState.generatedQuestions.forEach(question => {
                addToPracticeList(question);
            });
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            userStats.totalQuestions += agentState.generatedQuestions.length;
            updateUserStats();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            addMessageToChat('system', `å·²å°†${agentState.generatedQuestions.length}é“é¢˜ç›®æ·»åŠ åˆ°ç»ƒä¹ åˆ—è¡¨ï¼Œå¯ä»¥å¼€å§‹ç»ƒä¹ äº†ï¼`);
            
            // ä¿å­˜æ•°æ®
            saveUserData();
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`${agentState.generatedQuestions.length}é“é¢˜ç›®å·²æ·»åŠ åˆ°ç»ƒä¹ åˆ—è¡¨ï¼`);
            
            // é‡æ–°åŠ è½½ç»ƒä¹ æ•°æ®
            loadPracticeData();
            
            // éšè—é¢„è§ˆåŒºåŸŸ
            document.getElementById('questions-preview').style.display = 'none';
        }
        
        // æ·»åŠ åˆ°ç»ƒä¹ åˆ—è¡¨
        function addToPracticeList(question) {
            const newQuestion = {
                id: Date.now(),
                title: `${question.knowledgeText}ç»ƒä¹ é¢˜`,
                type: question.type,
                difficulty: question.difficulty,
                content: question.content,
                timeAgo: "åˆšåˆš",
                knowledge: question.knowledgeText
            };
            
            practiceData.practiceList.unshift(newQuestion);
        }
        
        // åŠ è½½ç»ƒä¹ æ•°æ®
        function loadPracticeData() {
            updatePracticeDisplay();
        }
        
        // æ›´æ–°ç»ƒä¹ æ˜¾ç¤º
        function updatePracticeDisplay() {
            console.log('ç»ƒä¹ æ•°æ®å·²æ›´æ–°');
        }
        
        // åˆ‡æ¢åˆ°ç»ƒä¹ æ ‡ç­¾
        function switchPracticeTab(tabName) {
            document.querySelectorAll('.practice-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
            
            document.getElementById('practice-list-content').style.display = 'none';
            document.getElementById('wrong-questions-content').style.display = 'none';
            document.getElementById('bookmarked-content').style.display = 'none';
            
            document.getElementById(`${tabName}-content`).style.display = 'block';
        }
        
        // å¼€å§‹ç»ƒä¹ 
        function startPractice(questionId) {
            window.open(`http://127.0.0.1:5500/%E7%BB%83%E4%B9%A0%E9%A1%B5%E9%9D%A2.html?id=${questionId}`, '_blank');
        }
        
        // æ·»åŠ åˆ°æ”¶è—
        function addToBookmark(questionId) {
            if (!userStats.bookmarkedQuestions.includes(questionId)) {
                userStats.bookmarkedQuestions.push(questionId);
                saveUserData();
                showNotification('å·²æ·»åŠ åˆ°æ”¶è—ï¼');
            }
        }
        
        // ç§»é™¤æ”¶è—
        function removeBookmark(questionId) {
            userStats.bookmarkedQuestions = userStats.bookmarkedQuestions.filter(id => id !== questionId);
            saveUserData();
            showNotification('å·²å–æ¶ˆæ”¶è—ï¼');
            loadPracticeData();
        }
        
        // å¤ä¹ é”™é¢˜
        function reviewWrongQuestion(questionId) {
            window.open(`http://127.0.0.1:5500/%E9%87%8D%E5%81%9A%E9%94%99%E9%A2%98.html?id=${questionId}`, '_blank');
        }
        
        // ä»é”™é¢˜æœ¬ç§»é™¤
        function removeFromWrong(questionId) {
            userStats.wrongQuestions = userStats.wrongQuestions.filter(id => id !== questionId);
            saveUserData();
            updateUserStats();
            showNotification('å·²ä»é”™é¢˜æœ¬ç§»é™¤ï¼');
            loadPracticeData();
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: linear-gradient(135deg, #4361ee, #7209b7);
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
                font-family: 'Inter', sans-serif;
                font-weight: 500;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-check-circle" style="font-size: 1.2rem;"></i>
                    <span>${message}</span>
                </div>
                <style>
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                </style>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // ä¿å­˜èŠå¤©å†å²
        function saveChatHistory() {
            try {
                localStorage.setItem('mathChatHistory', JSON.stringify(agentState.messages));
            } catch (e) {
                console.error('ä¿å­˜èŠå¤©å†å²å¤±è´¥:', e);
            }
        }
        
        // åŠ è½½èŠå¤©å†å²
        function loadChatHistory() {
            try {
                const saved = localStorage.getItem('mathChatHistory');
                if (saved) {
                    const messages = JSON.parse(saved);
                    messages.forEach(msg => {
                        addMessageToChat(msg.role, msg.content);
                    });
                    agentState.messages = messages;
                }
            } catch (e) {
                console.error('åŠ è½½èŠå¤©å†å²å¤±è´¥:', e);
            }
        }
        
        // ä¿å­˜ç”¨æˆ·æ•°æ®
        function saveUserData() {
            try {
                localStorage.setItem('mathUserStats', JSON.stringify(userStats));
                localStorage.setItem('mathPracticeData', JSON.stringify(practiceData));
            } catch (e) {
                console.error('ä¿å­˜ç”¨æˆ·æ•°æ®å¤±è´¥:', e);
            }
        }
        
        // åŠ è½½ç”¨æˆ·æ•°æ®
        function loadUserData() {
            try {
                const savedStats = localStorage.getItem('mathUserStats');
                const savedPractice = localStorage.getItem('mathPracticeData');
                
                if (savedStats) {
                    const data = JSON.parse(savedStats);
                    userStats = { ...userStats, ...data };
                    updateUserStats();
                }
                
                if (savedPractice) {
                    const data = JSON.parse(savedPractice);
                    Object.assign(practiceData, data);
                }
            } catch (e) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', e);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åŠ è½½ç”¨æˆ·æ•°æ®
        loadUserData();
    </script>
</body>
</html>